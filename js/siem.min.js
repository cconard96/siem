(function(){window.SIEMPlugin=function(){var d=this;this.ajax_root=CFG_GLPI.root_doc+"/plugins/siem/ajax/";this.dashboard="#siem-dashboard";$(document).ready(function(){if($(d.dashboard).length>0){d.refreshDashboard();setInterval(function(){d.refreshDashboard()},30000)}});var c=function(h){$(d.dashboard).empty();var g="<div class='container-fluid content'>";g+="<h2 class='text-center'>Event Monitoring Dashboard</h2>";g+="<p class='text-center'>"+new Date()+"</p>";g+="<div class='siem-decks'>";$.each(h,function(i,j){g+="<div class='siem-deck card-deck'>";$.each(j,function(l,k){var m=["siem-card","card","text-center","card-"+k.type];if(k.extra_card_classes!==undefined){m.concat(k.extra_card_classes)}g+="<div class='"+m.join(" ")+"'>";g+="<div class='card-header'><p class=''>"+k.title+"</p></div>";g+="<div class='card-body'>";g+=b(k);g+="</div></div>"});g+="</div>"});g+="</div></div>";$(g).appendTo($(d.dashboard))};var b=function(g){var h="";if(g.type==="counter"){return"<p>"+g.value+"</p>"}else{if(g.type==="table"){h+="<table class='w-100'><thead>";$.each(g.headers,function(j,k){h+="<th>"+k+"</th>"});h+="</thead><tbody>";$.each(g.rows,function(j,k){h+="<tr>";$.each(k,function(l,i){h+="<td class='"+(i["class"]||"")+"'>"+i.value+"</td>"});h+="</tr>"});h+="</tbody></table>"}else{if(g.type==="table-v"){h+="<table class='w-100'>";$.each(g.headers,function(k,l){var j=g.rows[k];h+="<tr class='"+(j["class"]||"")+"'>";h+="<th class=''text-center>"+l+"</th>";h+="<td class='text-left'>"+j.value+"</td>";h+="</tr>"});h+="</table>"}else{return"<p>"+g.value+"</p>"}}}return h};d.refreshDashboard=function(){var h=$(d.dashboard+" .siem-toolbar");var g=h.serialize();$.ajax({type:"GET",url:d.ajax_root+"siemdashboard.php",data:g,success:function(i){c(i)}})};this.toggleEventDetails=function(i){var j=$(i).attr("id");var h=$("#"+j+"_content");if(typeof h!==typeof undefined){var g=h.attr("hidden");if(typeof g!==typeof undefined){h.removeAttr("hidden")}else{h.attr("hidden","hidden")}}};this.updateSensorDropdown=function(j,h,g){var i=$(j).val();$.ajax({type:"GET",url:d.ajax_root+"getSensors.php",data:{plugins_id:i},success:function(l){var k=$(h);k.empty().select2({width:"max-content"});if(Object.keys(l).length>0){k.removeAttr("disabled");$(g).removeAttr("disabled")}else{k.attr("disabled","disabled");$(g).attr("disabled","disabled")}$.each(l,function(n,m){k.append(new Option(m,n,false,false))});k.trigger("change")}})};this.hostCheckNow=function(g){$.ajax({type:"POST",url:d.ajax_root+"siemhost.php",data:{_check_now:true,hosts_id:g}})};function a(g){}function e(g){}function f(g){}this.addHostService=function(g){$.ajax({type:"GET",url:d.ajax_root+"getSiemServiceTemplates.php",data:{},success:function(h){$("<div id='add-host-form'><select class='service-template-dropdown'></select></div>").dialog({modal:true,title:"Add service from template",open:function(){var i=$("#add-host-form .service-template-dropdown");i.empty().select2({width:"max-content"});if(Object.keys(h).length>0){i.removeAttr("disabled")}else{i.attr("disabled","disabled")}$.each(h,function(k,j){i.append(new Option(j,k,false,false))});i.trigger("change")},buttons:{Add:function(){var j=$(this);var i=$("#add-host-form").find("select").select2("val");$.ajax({type:"POST",url:d.ajax_root+"siemhost.php",data:{_add_service:true,hosts_id:g,servicetemplates_id:i},complete:function(){j.dialog("close")}})}}})}})}};window.pluginSiem=new SIEMPlugin()})();